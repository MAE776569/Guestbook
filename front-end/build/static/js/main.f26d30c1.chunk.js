(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{26:function(e,t,a){e.exports=a(41)},36:function(e,t,a){},39:function(e,t,a){},41:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),r=a(22),o=a.n(r),c=a(12),l=a(4),i=a(5),m=a(7),u=a(6),d=a(8),p=a(3),h=a(17),g=a(25),f=a(10),v=Object(n.createContext)({});function b(e){return function(t){return s.a.createElement(v.Consumer,null,function(a){return s.a.createElement(e,Object.assign({},t,a))})}}var E="http://localhost:8000/api";var N=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(m.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).handleLogout=function(e){e.preventDefault(),fetch("".concat(E,"/logout"),{method:"POST",headers:{"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){e.error||(a.props.handleLogoutUser(),a.props.history.push("/login"))}).catch(function(e){console.log(e)})},a}return Object(d.a)(t,e),Object(i.a)(t,[{key:"shouldComponentUpdate",value:function(e){return null!==e.loggedUser}},{key:"render",value:function(){var e=this.props.loggedUser;return s.a.createElement("nav",{className:"navbar navbar-light bg-light"},s.a.createElement("div",{className:"container"},s.a.createElement(p.b,{to:"/",className:"navbar-brand"},"Guestbook"),s.a.createElement("div",null,s.a.createElement("ul",{className:"navbar-nav ml-auto"},s.a.createElement("li",{className:"nav-item"},s.a.createElement("span",null,"Welcome, ",e.name),s.a.createElement("a",{href:"/logout",className:"nav-link d-inline-block ml-3",onClick:this.handleLogout},"Logout"))))))}}]),t}(n.Component),y=Object(h.g)(b(N)),j=a(15);var O=function(e){var t=e.queryUsers,a=Object(n.useState)(""),r=Object(j.a)(a,2),o=r[0],c=r[1];return s.a.createElement("div",{className:"d-flex flex-nowrap search-users"},s.a.createElement("form",{className:"w-100",onSubmit:function(e){e.preventDefault(),t(o),c("")}},s.a.createElement("div",{className:"input-group"},s.a.createElement("input",{type:"text",className:"form-control search-users__input",placeholder:"Enter name or username",value:o,onChange:function(e){return c(e.target.value)}}),s.a.createElement("div",{className:"input-group-append"},s.a.createElement("button",{type:"submit",className:"btn btn-outline-primary"},"Search")))))};var w=function(e){var t=e.user,a=e.activeUserID,n=e.setActiveUser;return s.a.createElement("li",{className:"list-group-item list-group-item-action user-item"+(a===t.id?" active":""),onClick:function(){return n(t.id)}},s.a.createElement("h6",{className:"user-item__name"},t.name),s.a.createElement("p",{className:"user-item__username"},t.username))};var U=function(e){var t=e.users,a=e.activeUserID,n=e.setActiveUser;return 0===t.length?s.a.createElement("div",{className:"empty-user-list d-flex justify-content-center align-items-center"},"No available users!"):s.a.createElement("ul",{className:"list-group"},t.map(function(e){return s.a.createElement(w,{key:e.id,user:e,activeUserID:a,setActiveUser:n})}))};var S=function(e){var t=e.conversation,a=e.loggedUserID,n=e.deleteMessage,r=e.setUpdatedMessage;return t.message?s.a.createElement("li",{className:"message-item px-3 py-1 mb-4 "+(a===t.sender?"mr-auto":"ml-auto")},s.a.createElement("div",{className:"message-item__date"},function(e){var t=new Date(e);return"".concat(t.getDate(),"/").concat(t.getMonth()+1,"/").concat(t.getFullYear(),", ").concat(t.getHours(),":").concat(t.getMinutes(),":").concat(t.getSeconds())}(t.createdAt)),s.a.createElement("div",{className:"message-item__text py-2"},t.message.text),a===t.sender&&s.a.createElement("div",{className:"btn-group btn-group-sm d-flex flex-row-reverse"},s.a.createElement("button",{type:"button",className:"message-item__button text-danger",onClick:function(){return n(t.message._id,t._id)}},"Delete"),s.a.createElement("button",{type:"button",className:"message-item__button text-info",onClick:function(){return r(t.message,t._id)}},"Update"))):s.a.createElement("li",{className:"message-item px-3 py-1 mb-4"},s.a.createElement("div",{className:"message-item__text py-2"},"This message was deleted"))},C=function(){return s.a.createElement("div",{className:"loading"})};var M=function(e){var t=e.messages,a=e.loggedUserID,n=e.deleteMessage,r=e.setUpdatedMessage;return void 0===t?s.a.createElement("div",{className:"empty-message-list d-flex justify-content-center align-items-center"},s.a.createElement(C,null)):0===t.length?s.a.createElement("div",{className:"empty-message-list d-flex justify-content-center align-items-center"},"No messages!"):s.a.createElement("ul",{className:"list-unstyled px-3 pt-2"},t.map(function(e){return s.a.createElement(S,{key:e.id,conversation:e,loggedUserID:a,deleteMessage:n,setUpdatedMessage:r})}))};var x=function(e){var t=e.sendMessage,a=Object(n.useState)(""),r=Object(j.a)(a,2),o=r[0],c=r[1];return s.a.createElement("div",{className:"d-flex flex-nowrap message-form"},s.a.createElement("form",{className:"w-100",onSubmit:function(e){e.preventDefault(),t(o),c("")}},s.a.createElement("div",{className:"input-group"},s.a.createElement("textarea",{className:"message-form__input",placeholder:"Enter Your Message",spellCheck:!0,value:o,onChange:function(e){return c(e.target.value)}}),s.a.createElement("div",{className:"input-group-append"},s.a.createElement("button",{type:"submit",className:"btn btn-outline-primary"},"Send")))))},k=function(e){function t(){return Object(l.a)(this,t),Object(m.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.closeModal,n=t.updatedMessage,r=t.handleUpdateMessage;return s.a.createElement("div",{className:"modal d-block"},s.a.createElement("div",{className:"modal-dialog"},s.a.createElement("div",{className:"modal-content"},s.a.createElement("div",{className:"modal-header"},s.a.createElement("h5",{className:"modal-title"},"Update Message"),s.a.createElement("button",{type:"button",className:"close","data-dismiss":"modal"},s.a.createElement("span",{onClick:a},"\xd7"))),s.a.createElement("div",{className:"modal-body"},s.a.createElement("label",{htmlFor:"text",className:"col-form-label mb-2"},"Enter the new message"),s.a.createElement("textarea",{id:"text",cols:"30",rows:"10",className:"form-control",ref:function(t){return e.textMessage=t}},n.text)),s.a.createElement("div",{className:"modal-footer"},s.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(){return r(e.textMessage.value)}},"Save Changes"),s.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:a},"Close")))))}}]),t}(n.Component),D=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(m.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={users:[],searchedQuery:"",activeUserID:"",conversations:{},showModal:!1,updatedMessage:null},a.handleSearchUsers=function(e){a.setState({searchedQuery:e})},a.handleSetActiveUser=function(e){var t,n,s=a.props.loggedUser,r=a.state.conversations;a.setState({activeUserID:e}),r[e]||(t=s.id,n=e,fetch("".concat(E,"/conversation?sender=").concat(t,"&receiver=").concat(n),{method:"GET",headers:{"Content-Type":"application/json"}}).then(function(e){return e.json()})).then(function(t){t.error||a.setState(function(a){return{conversations:Object(c.a)({},a.conversations,Object(f.a)({},e,t.conversations))}})}).catch(function(e){console.log(e)})},a.handleSendMessage=function(e){var t,n=a.state.activeUserID,s=a.props.loggedUser;(t={sender:s.id,receiver:n,text:e},fetch("".concat(E,"/conversation"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(function(e){return e.json()})).then(function(e){e.error||a.setState(function(t){return{conversations:Object(c.a)({},t.conversations,Object(f.a)({},n,[].concat(Object(g.a)(t.conversations[n]),[e.conversation])))}})}).catch(function(e){console.log(e)})},a.handleDeleteMessage=function(e,t){var n=a.state.activeUserID;(function(e){return fetch("".concat(E,"/messages/").concat(e),{method:"DELETE",headers:{"Content-Type":"application/json"}}).then(function(e){return e.json()})})(e).then(function(e){e.error||a.setState(function(e){return{conversations:Object(c.a)({},e.conversations,Object(f.a)({},n,e.conversations[n].map(function(e){return e._id===t?Object.assign(e,{message:null}):Object.assign(e,{})})))}})}).catch(function(e){console.log(e)})},a.closeModal=function(){a.setState({showModal:!1})},a.setUpdatedMessage=function(e,t){a.setState({showModal:!0,updatedMessage:{message:e,convID:t}})},a.handleUpdateMessage=function(e){var t=a.state,n=t.updatedMessage,s=t.activeUserID;(function(e,t){return fetch("".concat(E,"/messages/").concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:t})}).then(function(e){return e.json()})})(n.message._id,e).then(function(e){e.error||a.setState(function(t){return{conversations:Object(c.a)({},t.conversations,Object(f.a)({},s,t.conversations[s].map(function(t){return t._id===n.convID?Object.assign(t,{message:e.message}):Object(c.a)({},t)}))),showModal:!1}})}).catch(function(e){console.log(e)})},a}return Object(d.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){var e=this;fetch("".concat(E,"/users"),{method:"GET",headers:{"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(t){t.error||e.setState({users:t.users})}).catch(function(e){console.log(e)})}},{key:"render",value:function(){var e=this.props.loggedUser;if(!e)return s.a.createElement(h.a,{to:"/login"});var t=this.state.users,a=this.state,n=a.searchedQuery,r=a.activeUserID,o=a.conversations,c=a.showModal,l=a.updatedMessage;return t=t.filter(function(t){return t.id!==e.id&&(t.name.includes(n)||t.username.includes(n))}),s.a.createElement(s.a.Fragment,null,s.a.createElement(y,null),s.a.createElement("div",{className:"container pt-1 chat"},c&&s.a.createElement(k,{closeModal:this.closeModal,updatedMessage:l.message,handleUpdateMessage:this.handleUpdateMessage}),s.a.createElement("div",{className:"row px-3"},s.a.createElement("div",{className:"col-12 col-md-6 col-lg-8 order-1 ordre-md-0 messages-section"},r&&s.a.createElement(x,{sendMessage:this.handleSendMessage}),r?s.a.createElement(M,{messages:o[r],loggedUserID:e.id,deleteMessage:this.handleDeleteMessage,setUpdatedMessage:this.setUpdatedMessage}):s.a.createElement("div",{className:"empty-message-list d-flex justify-content-center align-items-center"},"Select user to start conversation")),s.a.createElement("div",{className:"col-12 col-md-6 col-lg-4 order-0 order-md-1 users-section"},s.a.createElement(O,{queryUsers:this.handleSearchUsers}),s.a.createElement(U,{users:t,activeUserID:r,setActiveUser:this.handleSetActiveUser})))))}}]),t}(n.Component),_=Object(h.g)(b(D));var I=function(){return s.a.createElement("div",{className:"col-12 col-md-8 col-lg-5 m-auto"},s.a.createElement("h1",null,"Guestbook"),s.a.createElement("p",{className:"lead"},"Send messages to other members and reply to messages"))},T=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(m.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={username:"",password:""},a.handleInputChange=function(e,t){a.setState(Object(f.a)({},t,e.target.value))},a.handleSubmit=function(e){var t;e.preventDefault(),(t=a.state,fetch("".concat(E,"/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(function(e){return e.json()})).then(function(e){e.error||(a.props.handleLoginUser(e),a.props.history.push("/"))}).catch(function(e){console.log(e)})},a}return Object(d.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;if(this.props.loggedUser)return s.a.createElement(h.a,{to:"/"});var t=this.state,a=t.username,n=t.password;return s.a.createElement("div",{className:"container mt-5 p-2"},s.a.createElement("div",{className:"row m-auto"},s.a.createElement(I,null),s.a.createElement("div",{className:"col-12 col-md-8 col-lg-5 m-auto"},s.a.createElement("form",{onSubmit:this.handleSubmit},s.a.createElement("div",{className:"form-row mb-2"},s.a.createElement("label",{htmlFor:"username",className:"col-form-label"},"Username"),s.a.createElement("input",{type:"text",id:"username",className:"form-control",placeholder:"Mohamed55",value:a,onChange:function(t){return e.handleInputChange(t,"username")}})),s.a.createElement("div",{className:"form-row mb-2"},s.a.createElement("label",{htmlFor:"password",className:"col-form-label"},"Password"),s.a.createElement("input",{type:"password",id:"password",className:"form-control",placeholder:"Enter your password",value:n,onChange:function(t){return e.handleInputChange(t,"password")}})),s.a.createElement("div",{className:"form-row"},s.a.createElement("input",{type:"submit",value:"Login",className:"btn d-inline-block btn-outline-primary"}),s.a.createElement(p.b,{to:"/signup",className:"d-inline-block ml-auto align-self-center"},"Not a member? Sign up"))))))}}]),t}(n.Component),L=Object(h.g)(b(T)),A=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(m.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={name:"",username:"",password:"",confirmPassword:""},a.handleInputChange=function(e,t){a.setState(Object(f.a)({},t,e.target.value))},a.handleSubmit=function(e){e.preventDefault();var t,n=a.state,s=n.name,r=n.username,o=n.password,c=n.confirmPassword;(t={name:s,username:r,password:o,"c-password":c},fetch("".concat(E,"/signup"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(function(e){return e.json()})).then(function(e){e.error||(a.props.handleLoginUser(e),a.props.history.push("/"))}).catch(function(e){console.log(e)})},a}return Object(d.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;if(this.props.loggedUser)return s.a.createElement(h.a,{to:"/"});var t=this.state,a=t.name,n=t.username,r=t.password,o=t.confirmPassword;return s.a.createElement("div",{className:"container mt-5 p-2"},s.a.createElement("div",{className:"row m-auto"},s.a.createElement(I,null),s.a.createElement("div",{className:"col-12 col-md-8 col-lg-5 m-auto"},s.a.createElement("form",{onSubmit:this.handleSubmit},s.a.createElement("div",{className:"form-row mb-2"},s.a.createElement("label",{htmlFor:"name",className:"col-form-label"},"Name"),s.a.createElement("input",{type:"text",id:"name",className:"form-control",placeholder:"Enter your name",value:a,onChange:function(t){return e.handleInputChange(t,"name")}})),s.a.createElement("div",{className:"form-row mb-2"},s.a.createElement("label",{htmlFor:"username",className:"col-form-label"},"Username"),s.a.createElement("input",{type:"text",id:"username",className:"form-control",placeholder:"Mohamed55",value:n,onChange:function(t){return e.handleInputChange(t,"username")}})),s.a.createElement("div",{className:"form-row mb-2"},s.a.createElement("label",{htmlFor:"password",className:"col-form-label"},"Password"),s.a.createElement("input",{type:"password",id:"password",className:"form-control",placeholder:"Enter your password",value:r,onChange:function(t){return e.handleInputChange(t,"password")}})),s.a.createElement("div",{className:"form-row mb-2"},s.a.createElement("label",{htmlFor:"c-password",className:"col-form-label"},"Confirm Password"),s.a.createElement("input",{type:"password",id:"c-password",className:"form-control",placeholder:"Enter the same password as before",value:o,onChange:function(t){return e.handleInputChange(t,"confirmPassword")}})),s.a.createElement("div",{className:"form-row"},s.a.createElement("input",{type:"submit",value:"Sign Up",className:"btn d-inline-block btn-outline-primary"}),s.a.createElement(p.b,{to:"/login",className:"d-inline-block ml-auto align-self-center"},"Already a member? Login"))))))}}]),t}(n.Component),P=Object(h.g)(b(A));var F=function(){return s.a.createElement("div",{className:"not-found"},s.a.createElement("div",null,s.a.createElement("h1",{className:"not-found__title"},"404"),s.a.createElement("div",{className:"not-found-subheader"},s.a.createElement("h2",{className:"not-found__subtitle"},"This page could not be found"))))};var J=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(m.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={loading:!0,loggedUser:null},a.handleLoginUser=function(e){a.setState({loggedUser:e})},a.handleLogoutUser=function(){a.setState({loggedUser:null})},a}return Object(d.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){var e=this;!this.state.loggedUser&&Object.fromEntries(document.cookie.split(";").map(function(e){return e.trim().split("=")})).SID?fetch("".concat(E,"/me"),{method:"GET",headers:{"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(t){t.error||e.setState({loggedUser:t,loading:!1})}).catch(function(e){console.log(e)}):this.setState({loading:!1})}},{key:"render",value:function(){if(this.state.loading)return s.a.createElement("div",{className:"loading-container"},s.a.createElement(C,null));var e=Object(c.a)({},this.state,{handleLoginUser:this.handleLoginUser,handleLogoutUser:this.handleLogoutUser}),t=v;return s.a.createElement(t.Provider,{value:e},s.a.createElement(p.a,null,s.a.createElement(h.d,null,s.a.createElement(h.b,{exact:!0,path:"/",component:_}),s.a.createElement(h.b,{path:"/login",component:L}),s.a.createElement(h.b,{path:"/Signup",component:P}),s.a.createElement(h.b,{component:F}))))}}]),t}(n.Component);a(36),a(39);o.a.render(s.a.createElement(J,null),document.getElementById("root"))}},[[26,2,1]]]);
//# sourceMappingURL=main.f26d30c1.chunk.js.map